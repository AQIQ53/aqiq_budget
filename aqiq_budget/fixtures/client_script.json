[
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Budget Tool",
  "enabled": 1,
  "modified": "2024-06-26 10:53:28.148456",
  "module": "Aqiq Budget",
  "name": "Monthly Budget Distribution Tool",
  "script": "frappe.ui.form.on('Budget Tool', {\n \n\n before_save(frm){\n     if(frm.doc.applicable_on_material_request===1){\n         if(frm.doc.applicable_on_purchase_order===0){\n            frappe.throw('Please enable Applicable on Purchase Order and Applicable on Booking Actual Expenses')\n\n         }\n     }\n     if(frm.doc.applicable_on_purchase_order===1){\n         if(frm.doc.applicable_on_booking_actual_expenses==0){\n              frappe.throw('Please enable Applicable on Booking Actual Expenses')\n         }\n     }\n },\n cost_center(frm){\n     \n     frappe.call({\n        method: 'frappe.client.get_value',\n        args: {\n            'doctype': 'Cost Center',\n            'filters': {'name': frm.doc.cost_center},\n            'fieldname': [\n                'custom_section'\n            ]\n        },\n        callback: function(r) {\n            if (!r.exc) {\n                section=r.message.custom_section;\n                console.log(section)\n                frm.set_value('section',section)\n                frm.refresh_field('section')\n            }\n        }\n    });\n\n },\n\n\trefresh(frm) {\n\t\t// your code here\n\t\tconsole.log(frm.doc.monthly_budget_distribution_table)\n        frm.set_query(\"account\", \"monthly_budget_distribution_table\", function() {\n\t\t\treturn {\n\t\t\t\tfilters: {\n\t\t\t\t\tcompany: frm.doc.company,\n\t\t\t\t\treport_type: \"Profit and Loss\",\n\t\t\t\t\tis_group: 0\n\t\t\t\t}\n\t\t\t};\n\t\t});\n\t\tif (frm.doc.docstatus==1) {\n\t\t    \n\t\t}\n\n\t},\n\tvalidate(frm){\n\t    console.log(frm.doc.monthly_budget_distribution_table)\n\t    budgetData=frm.doc.monthly_budget_distribution_table\n\t    budgetData.forEach(budget => {\n            let total = budget.january + budget.february + budget.march + budget.april +\n                        budget.may + budget.june + budget.july + budget.august +\n                        budget.september + budget.october + budget.november + budget.december;\n        \n            budget.total_amount = total;\n            console.log(`Total amount for account ${budget.account}: ${total}`);\n           \n        });\n        frm.refresh_field('monthly_budget_distribution_table')\n        // If you need the modified budgetData with updated total_amount\n        console.log(budgetData);\n\t},\n\ton_submit(frm){\n                frappe.call({\n                    method: 'aqiq_budget.aqiq_budget.doctype.budget_tool.budget_tool.create_budget',\n                    args: {\n                      'name':frm.doc.name\n                    },\n                    callback: function(r) {\n                        if (!r.exc) {\n                            // code snippet\n                        }\n                    }\n                });\n\t},\n\tbefore_cancel(frm){\n    frappe.call({\n            method: 'aqiq_budget.aqiq_budget.doctype.budget_tool.budget_tool.cancel_budget',\n            args: {\n                'name':frm.doc.name\n            },\n            callback: function(r) {\n                if (!r.exc) {\n                    // code snippet\n                    console.log(r.message)\n                    \n                   \n                }\n            }\n        });\n\t}\n})\n\nfrappe.ui.form.on('Monthly Budget Distribution Table', {\n\trefresh(frm) {\n\t\t// your code here\n\t},\n\t\n})",
  "view": "Form"
 }
]